#!/bin/bash

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ½ÐµÑ€Ð³Ð¾ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹ Ð­ÑÑ‚Ð¾Ð½Ð¸Ð¸"
echo "=================================================="

if ! command -v docker &> /dev/null; then
    echo "âŒ Docker Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "âŒ Docker Compose Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker Compose"
    exit 1
fi

if [ ! -f ".env" ]; then
    echo "ðŸ”§ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°..."
    cat > .env << EOF
HOST=0.0.0.0
PORT=9000
DEBUG=False
DATABASE_URL=energy_system.db
SECRET_KEY=est_energy_system_secret_key
EOF
fi

echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹..."
mkdir -p data logs

echo "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²..."
docker-compose down

echo "ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ° Docker Ð¾Ð±Ñ€Ð°Ð·Ð°..."
docker-compose build

echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€Ð° Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ðµ..."
echo "ðŸ“ Ð¡ÐµÑ€Ð²ÐµÑ€: http://localhost:9000"
echo ""
echo "ðŸ›‘ Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
echo ""

docker-compose up
